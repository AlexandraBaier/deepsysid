# multistep_sysid

## How to use?

Set the following environment variables:
```
DATASET_DIRECTORY=<root directory of dataset with at least child directory processed>
RESULT_DIRECTORY=<directory for validation/test results>
CONFIGURATION=<JSON configuration file>
```

### Directories

### Configuration

The JSON configuration file is used to set hyperparameters for any model in the `multistep_sysid` package.
The JSON file has the following format:
```json
{
  "train_fraction": "float < 1.0",
  "validation_fraction": "float < 1.0",
  "time_delta": "float, sampling rate of dataset in seconds",
  "window": "int, size of window of initial state and control inputs during evaluation",
  "horizon": "int, prediction horizon used during evaluation",
  "control_names": "list of strings, names of control/external inputs as defined in the dataset CSV",
  "state_names": "list of strings, names of measured (and also predicted) system states as defined in the dataset CSV",
  "thresholds": "list of floats, threshold values for which the hybrid models should be evaluated",
  "models": {
    "str, unique name of model": {
      "model_class": "str, full Python class name of model including full package, for example, multistep_sysid.models.linear.LinearModel",
      "location": "str, directory where model files should be saved such as weights and normalization parameters",
      "parameters": {
        "hyperparameter_name": "hyperparameter_value, an example follows",
        "dropout": 0.25
      }
    }
  }
}
```

Alternatively, a gridsearch template JSON format can be used to generate the above configuration file
using the script `scripts/build_gridsearch_configuration.py`.
It allows the generation of models with a large number of hyperparameter combinations. 
The gridsearch template has the following format:
```json
{
  "base_path": "str, directory where all trained models should be saved to, subdirectories will be created for each separate model",
  "settings": {
    "train_fraction": "float < 1.0",
    "validation_fraction": "float < 1.0",
    "time_delta": "float",
    "window": "int",
    "horizon": "int",
    "control_names": "list of strings",
    "state_names": "list of strings",
    "thresholds": "list of floats",
    "models": [
      {
        "model_base_name": "str, base name of model will be extended by combination of hyperparameter",
        "model_class": "str",
        "static_parameters": {
          "hyperparameter name": "hyperparameter value, static parameters remain the same for all models of this base_name, no grid search will be performed over these parameters"
        },
        "flexible_parameters": {
          "hyperparameter name": "list of hyperparameter values, gridsearch is performed over flexible parameters, the cartesian product over all possible flexible parameter combinations is generated as distinct models"
        }
      }
    ]
  }
}
```
If you use the template format, the environment variable should still point to the JSON configuration file, that is generated by the script.

### Training

### Testing
